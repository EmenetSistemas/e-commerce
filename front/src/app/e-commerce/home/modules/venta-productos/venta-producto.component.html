<div class="modal-body">
    <div class="pagetitle">
        <ng-container *ngIf="!this.productos.static ?? true; else pedidos">
            <h1>{{this.productos.items.length > 1 ? 'Productos' : 'Producto'}}</h1>
        </ng-container>
        <ng-template #pedidos>
            <h1>Pedido #PE-{{this.productos.idPedido}}</h1>
        </ng-template>
        
        <nav>
            <ol class="breadcrumb">
                <li class="breadcrumb-item">Detalles</li>
                <li class="breadcrumb-item active">Compra</li>
            </ol>
        </nav>
    </div>

    <div class="alert alert-warning alert-dismissible fade show" role="alert" *ngIf="(this.productos.static ?? false) && this.productos.fkStatus == 1">
        <i class="bi bi-exclamation-triangle me-1"></i>
        Solo se pueden cancelar productos si aún no han sido enviados
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <div class="col-12" *ngIf="!this.productos.static ?? true">
        <div class="card" style="margin-top: -15px !important;">
            <div class="card-body">
                <ul class="nav nav-tabs nav-tabs-bordered d-flex" id="borderedTabJustified" role="tablist"
                    style="margin-top: 5px;">
                    <li class="nav-item flex-fill" role="presentation" style="pointer-events: none;">
                        <button #productosBtn class="nav-link w-100 active" id="home-tab" data-bs-toggle="tab"
                            data-bs-target="#bordered-justified-home" type="button" role="tab" aria-controls="home"
                            aria-selected="false" tabindex="-1">Productos</button>
                    </li>
                    <li class="nav-item flex-fill" role="presentation" style="pointer-events: none;">
                        <button #procederAlPagoBtn class="nav-link w-100" id="profile-tab" data-bs-toggle="tab"
                            data-bs-target="#bordered-justified-profile" type="button" role="tab"
                            aria-controls="profile" aria-selected="true">Pago</button>
                    </li>                    
                    <li class="nav-item flex-fill" role="presentation" style="pointer-events: none;">
                        <button #realizarPedidoBtn class="nav-link w-100" id="contact-tab" data-bs-toggle="tab"
                            data-bs-target="#bordered-justified-contact" type="button" role="tab"
                            aria-controls="contact" aria-selected="false" tabindex="-1">Entrega</button>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <div class="tab-content pt-2" id="borderedTabJustifiedContent">
        <div class="tab-pane fade active show" id="bordered-justified-home" role="tabpanel" aria-labelledby="home-tab">
            <section class="section profile formsWTitle">
                <div class="row">
                    <div class="col-12">
                        <!--Productos detalle-->
                        <div class="col-lg-9 col-12 apartado-productos">
                            <section *ngFor="let producto of this.productos.items" style="margin-top: -55px;">
                                <app-producto-venta [producto]="producto" [static]="this.productos.static"
                                    [fkStatus]="this.productos.fkStatus"
                                    (selectionChange)="cambioCantidadProducto($event)"
                                    (eliminoProducto)="eliminarProducto($event)"></app-producto-venta>
                            </section>
                            <br>
                        </div>

                        <!--Costo total compra-->
                        <div class="col-lg-3 col-12 card-precio">
                            <div class="card">
                                <div class="card-body">
                                    <ng-container *ngIf="!this.productos.static ?? true; else totalpedidos">
                                        <p style="color:gray">Subtotal
                                            ({{this.obtenerCantidadTotal()+(this.obtenerCantidadTotal() >
                                            1 ? ' productos' : ' producto')}}): <b>$ {{this.obtenerTotalSegunProductos() |
                                                number:'1.2-2'}}</b></p>
                                        <button *ngIf="!this.productos.static ?? true" class="btn btn-primary form-control" (click)="procederPago()">Proceder al pago</button>
                                        <br *ngIf="!this.productos.static ?? true">&nbsp;
                                    </ng-container>
                                    <ng-template #totalpedidos>
                                        <p style="color:gray">Total
                                            ({{this.obtenerCantidadTotal()+(this.obtenerCantidadTotal() >
                                            1 ? ' productos' : ' producto')}}): <b>$ {{this.obtenerTotalSegunProductos() |
                                                number:'1.2-2'}}</b></p>
                                    </ng-template>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
        <div class="tab-pane fade" id="bordered-justified-profile" role="tabpanel" aria-labelledby="profile-tab" *ngIf="this.usuario.direccion">
            <section class="section profile formsWTitle">
                <div class="row">
                    <div class="col-12">
                        <div class="col-lg-9 col-12 apartado-detalle-envio">
                            <div class="card">
                                <div class="card-body">
                                    <div class="col-12 direccion">
                                        <h5 class="t-bold apartado-titulo-detalle">
                                            Dirección
                                            <span class="badge border-primary border-1 text-primary">Cambiar</span>
                                        </h5>
                                        <p>
                                            {{this.usuario.direccion.calle}} {{this.usuario.direccion.noExterior}}<br>
                                            {{this.usuario.direccion.localidad}}<br>
                                            {{this.usuario.direccion.municipio}}, {{this.usuario.direccion.estado}}<br>
                                            {{this.usuario.direccion.cp}}<br>
                                        </p>
                                    </div>
                                    <div class="col-12 direccion">
                                        <hr>
                                        <h5 class="t-bold apartado-titulo-detalle">
                                            Métdodo de pago
                                            <span class="badge border-primary border-1 text-primary">Cambiar</span>
                                        </h5>
                                        <p *ngIf="this.usuario.metodoPago.emisor != null">
                                            Pagar con {{this.usuario.metodoPago.emisor}} <b>*{{this.usuario.metodoPago.noTarjeta.substring(this.usuario.metodoPago.noTarjeta.length - 4)}}</b><br>
                                        </p>
                                    </div>
                                    <div class="col-12 direccion">
                                        <hr>
                                        <h5 class="t-bold apartado-titulo-detalle">
                                            Productos
                                            <span class="badge border-warning border-1 text-warning" (click)="verProductos()">Ver</span>
                                        </h5>
                                        <p>
                                            <b>{{this.obtenerCantidadTotal()}}</b>{{(this.obtenerCantidadTotal() > 1 ? ' productos diferentes' : ' producto')}}<br>
                                            <b>{{this.obtenerTotalArticulos()}}</b>{{(this.obtenerTotalArticulos() > 1 ? ' artículos en total' : ' artículo en total')}}
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-12 card-precio">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="t-bold">Confirmación del Pedido</h5>
                                    <p style="color:gray">
                                        Subtotal(1 producto):<b> $ {{this.obtenerTotalSegunProductos() | number:'1.2-2'}}</b><br>
                                        <span class="t-bold" style="color:brown">Total (IVA incluido, en caso de ser aplicable): $ {{this.obtenerTotalSegunProductos() | number:'1.2-2'}}</span><br><br>
                                        Fecha de entrega estimada: <b>{{this.fechaEntregaEstimada() | date: 'd-M-y'}}</b>
                                    </p>
                                    <button class="btn btn-primary form-control" (click)="realizarPedido()">Realizar pedido y pagar</button>
                                    <br>&nbsp;
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
        <div class="tab-pane fade" id="bordered-justified-contact" role="tabpanel" aria-labelledby="contact-tab" *ngIf="this.usuario.direccion">
            <div class="col-12">
                <div class="card">
                    <div class="card-body card-sp">
                        <h5 class="t-bold" style="color:mediumseagreen;">Pedido realizado, ¡gracias!</h5>
                        <p>
                            Se enviará la confirmación a tu email.<br>
                            <b>Enviando a {{this.usuario.nombre}} {{this.usuario.aPaterno}}</b> en {{this.usuario.direccion.calle}}, {{this.usuario.direccion.localidad}}, {{this.usuario.direccion.municipio}}, {{this.usuario.direccion.municipio}} {{this.usuario.direccion.cp}}
                        </p>

                        <div class="alert alert-info alert-dismissible fade show" role="alert">
                            <i class="bi bi-info-circle me-1"></i>
                            Para cancelación de productos o pedidos se puede realizar unicamente antes de que sean enviados
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal-footer">
    <ng-container *ngIf="!this.productos.static ?? true; else abrirPedidos">
        <button type="button" class="btn btn-danger" data-bs-dismiss="modal" (click)="cerrarModal()"><b>Cancelar</b></button>
    </ng-container>
    <ng-template #abrirPedidos>
        <button type="button" class="btn btn-warning" data-bs-dismiss="modal" (click)="abrirModal()"><b>Volver</b></button>
    </ng-template>
</div>